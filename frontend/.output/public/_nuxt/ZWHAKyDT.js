import{u as A,_ as N}from"./Cg97V0GM.js";import{_ as T}from"./ClKX_v3o.js";import{_ as M}from"./DYlD4L2L.js";import{_ as R,a as V}from"./BIHxU0IE.js";import{_ as L}from"./Cv3A62oR.js";import{_ as X}from"./BKSQtRzV.js";import{_ as F}from"./BIk-UJZc.js";import{g as z,I as H,j as J,J as K,c as p,k as e,l as B,w as s,n as f,o as l,b as o,a,d as r,t as _,m as C,A as O,s as U}from"./DsjOer2v.js";import{s as q}from"./B0NY7V8c.js";import"./PBMIlgjC.js";const G={class:"flex min-h-[60vh] items-center justify-center"},Q={key:0,class:"h-64 w-full max-w-md animate-pulse rounded-xl bg-muted"},W={class:"text-muted-foreground"},Y={class:"font-semibold text-foreground"},Z={key:0,class:"rounded-lg border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive"},tt={key:1,class:"space-y-3"},et={class:"rounded-lg bg-muted p-4"},st={class:"mt-1 text-lg font-bold"},ot={class:"flex gap-3"},at={class:"flex-1 rounded-lg bg-muted p-4"},nt={key:0,class:"flex-1 rounded-lg bg-muted p-4"},gt=z({__name:"[bookingId]",setup(lt){const D=H(),x=A(),g=D.params.bookingId,d=f(null),w=f(!0),v=f(!1),$=f(!1),i=f(""),c=f("");let u=null;J(async()=>{try{const{data:n}=await x.get(`/bookings/${g}`);if(d.value=n,n.lockExpiresAt){const t=new Date(n.lockExpiresAt);u=q(()=>{const m=t.getTime()-Date.now();if(m<=0){c.value="EXPIRED",clearInterval(u);return}const b=Math.floor(m/6e4),k=Math.floor(m%6e4/1e3);c.value=`${b}:${k.toString().padStart(2,"0")}`},1e3)}}catch{i.value="Failed to load booking"}finally{w.value=!1}});async function h(){v.value=!0,i.value="";try{await x.post(`/bookings/${g}/pay`),await x.post(`/bookings/${g}/confirm`),$.value=!0,u&&clearInterval(u)}catch(n){i.value=n.response?.data?.error||"Payment failed"}finally{v.value=!1}}async function P(){try{await x.post(`/bookings/${g}/cancel`),U("/")}catch(n){i.value=n.response?.data?.error||"Cancel failed"}}return K(()=>{u&&clearInterval(u)}),(n,t)=>{const m=V,b=R,k=T,S=L,y=X,E=M,I=N,j=F;return l(),p("div",G,[e(w)?(l(),p("div",Q)):e($)?(l(),B(I,{key:1,class:"w-full max-w-md border-emerald-500/30 bg-emerald-500/5 text-center"},{default:s(()=>[o(b,null,{default:s(()=>[t[1]||(t[1]=a("div",{class:"text-5xl mb-2"},"ðŸŽ‰",-1)),o(m,{class:"text-2xl text-emerald-400"},{default:s(()=>[...t[0]||(t[0]=[r("Booking Confirmed!",-1)])]),_:1})]),_:1}),o(k,null,{default:s(()=>[a("p",W,[t[2]||(t[2]=r("Seats: ",-1)),a("span",Y,_(e(d)?.seats?.join(", ")),1)])]),_:1}),o(E,{class:"justify-center"},{default:s(()=>[o(y,{"as-child":""},{default:s(()=>[o(S,{to:"/"},{default:s(()=>[...t[3]||(t[3]=[r("Back to Movies",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):(l(),B(I,{key:2,class:"w-full max-w-md"},{default:s(()=>[o(b,{class:"text-center"},{default:s(()=>[o(m,{class:"text-2xl"},{default:s(()=>[...t[4]||(t[4]=[r("Checkout",-1)])]),_:1})]),_:1}),o(k,{class:"space-y-4"},{default:s(()=>[e(i)?(l(),p("div",Z,_(e(i)),1)):C("",!0),e(d)?(l(),p("div",tt,[a("div",et,[t[5]||(t[5]=a("div",{class:"text-xs text-muted-foreground"},"Seats",-1)),a("div",st,_(e(d).seats?.join(", ")),1)]),a("div",ot,[a("div",at,[t[6]||(t[6]=a("div",{class:"text-xs text-muted-foreground"},"Status",-1)),o(j,{class:"mt-1",variant:e(d).status==="LOCKED"?"secondary":"default"},{default:s(()=>[r(_(e(d).status),1)]),_:1},8,["variant"])]),e(c)?(l(),p("div",nt,[t[7]||(t[7]=a("div",{class:"text-xs text-muted-foreground"},"Time Left",-1)),a("div",{class:O(["mt-1 font-mono text-lg font-bold",e(c)==="EXPIRED"?"text-red-400":"text-blue-300"])},_(e(c)),3)])):C("",!0)])])):C("",!0)]),_:1}),o(E,{class:"gap-3"},{default:s(()=>[o(y,{variant:"ghost",class:"flex-1",onClick:P},{default:s(()=>[...t[8]||(t[8]=[r("Cancel",-1)])]),_:1}),o(y,{class:"flex-1",disabled:e(v)||e(c)==="EXPIRED",onClick:h},{default:s(()=>[r(_(e(v)?"Processing...":"Pay & Confirm"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))])}}});export{gt as default};
